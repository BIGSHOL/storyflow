# User Flow (사용자 흐름도)

> StoryFlow Creator 수익화 기능 - 사용자 여정

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 지속 가능한 서비스 운영을 위한 수익화 기능 구현 |
| 2 | 페르소나 | 간단한 개인 페이지가 필요한 누구나 |
| 3 | 핵심 기능 | FEAT-1: 플랜별 기능 제한 시스템 |
| 4 | 성공 지표 (노스스타) | 월 유료 구독자 수 |
| 5 | 입력 지표 | 무료→유료 전환율, 플랜 업그레이드 클릭 수 |
| 6 | 비기능 요구 | 결제 처리 응답 시간 < 3초 |
| 7 | Out-of-scope | 커스텀 도메인 연결, 연간 결제 |
| 8 | Top 리스크 | 무료 사용자 이탈 |
| 9 | 완화/실험 | Notion 스타일의 관대한 무료 플랜 유지 |
| 10 | 다음 단계 | 플랜 제한 시스템 구현 |

---

## 1. 전체 사용자 여정 (Overview)

```mermaid
graph TD
    A[앱 진입] --> B{로그인 상태?}
    B -->|No| C[로그인/가입]
    B -->|Yes| D[메인 화면]
    C --> D

    D --> E[프로젝트 생성/편집]
    E --> F{제한 체크}

    F -->|제한 내| G[작업 진행]
    F -->|제한 도달| H[업그레이드 안내]

    G --> I[내보내기]
    I --> J{내보내기 제한?}
    J -->|제한 내| K[HTML 다운로드]
    J -->|제한 도달| H

    H --> L{업그레이드?}
    L -->|Yes| M[결제 진행]
    L -->|No| N[무료 기능 계속 사용]

    M --> O{결제 성공?}
    O -->|Yes| P[Pro 플랜 활성화]
    O -->|No| Q[재시도 안내]

    P --> G
    Q --> M
    N --> D
```

---

## 2. FEAT-0: 기존 인증 플로우 (변경 없음)

```mermaid
graph TD
    A[시작 화면] --> B{로그인 상태?}

    B -->|로그인됨| C[메인 화면]
    B -->|비로그인| D[로그인 선택]

    D --> E[이메일 로그인]
    D --> F[Google 로그인]
    D --> G[GitHub 로그인]

    E --> H{인증 성공?}
    F --> H
    G --> H

    H -->|Yes| I[플랜 확인]
    H -->|No| J[에러 표시]

    I --> K{플랜 정보 있음?}
    K -->|No| L[Free 플랜 배정]
    K -->|Yes| C
    L --> C

    J --> D
```

---

## 3. FEAT-1: 플랜 제한 체크 플로우

### 3.1 프로젝트 생성 제한

```mermaid
graph TD
    A[새 프로젝트 버튼 클릭] --> B[현재 플랜 확인]
    B --> C[프로젝트 개수 조회]
    C --> D{제한 체크}

    D -->|Free & 3개 미만| E[프로젝트 생성]
    D -->|Free & 3개 이상| F[업그레이드 모달]
    D -->|Pro/Team| E

    E --> G[템플릿 선택]
    G --> H[에디터 진입]

    F --> I{업그레이드?}
    I -->|Yes| J[결제 페이지]
    I -->|Later| K[모달 닫기]

    J --> L[결제 완료 후 프로젝트 생성]
```

### 3.2 내보내기 제한 (기존 로직 확장)

```mermaid
graph TD
    A[내보내기 버튼 클릭] --> B[현재 플랜 확인]
    B --> C{플랜 타입?}

    C -->|Free| D[일일 사용량 확인]
    C -->|Pro/Team| E[바로 내보내기]

    D --> F{10회 이하?}
    F -->|Yes| E
    F -->|No| G[제한 안내 모달]

    E --> H[HTML 생성]
    H --> I{브랜딩 옵션}
    I -->|Free| J[워터마크 포함]
    I -->|Pro/Team| K[워터마크 제거]

    J --> L[다운로드]
    K --> L

    G --> M{업그레이드?}
    M -->|Yes| N[결제 페이지]
    M -->|내일까지 대기| O[모달 닫기]
```

### 3.3 협업자 초대 제한

```mermaid
graph TD
    A[협업자 초대 버튼] --> B[현재 플랜 확인]
    B --> C[현재 협업자 수 조회]
    C --> D{제한 체크}

    D -->|Free & 0명| E[초대 진행]
    D -->|Free & 1명| F[업그레이드 안내]
    D -->|Pro & 5명 미만| E
    D -->|Pro & 5명| F
    D -->|Team| E

    E --> G[이메일 입력]
    G --> H[초대 전송]
    H --> I[완료 메시지]

    F --> J{업그레이드?}
    J -->|Yes| K[결제 페이지]
    J -->|No| L[모달 닫기]
```

---

## 4. FEAT-2: 결제 플로우 (v2)

### 4.1 구독 시작

```mermaid
graph TD
    A[요금제 페이지 진입] --> B[플랜 비교 표시]
    B --> C{플랜 선택}

    C -->|Pro| D[Pro 선택]
    C -->|Team| E[Team 선택]

    D --> F[토스 결제창]
    E --> F

    F --> G[카드 정보 입력]
    G --> H{결제 승인?}

    H -->|Yes| I[빌링키 저장]
    H -->|No| J[에러 표시]

    I --> K[구독 활성화]
    K --> L[성공 페이지]
    L --> M[플랜 기능 해제]

    J --> N{재시도?}
    N -->|Yes| F
    N -->|No| O[요금제 페이지로]
```

### 4.2 구독 취소

```mermaid
graph TD
    A[설정 - 구독 관리] --> B[현재 구독 정보 표시]
    B --> C[구독 취소 버튼]

    C --> D[취소 확인 모달]
    D --> E{확인?}

    E -->|Yes| F[취소 사유 선택]
    E -->|No| G[모달 닫기]

    F --> H[취소 처리]
    H --> I[토스 빌링 해지]
    I --> J[DB 상태 업데이트]

    J --> K[취소 완료 안내]
    K --> L[현재 결제 주기까지 Pro 유지 안내]
```

---

## 5. 업그레이드 안내 UI 플로우

### 5.1 제한 도달 시 안내 (비공격적)

```mermaid
graph TD
    A[제한 도달] --> B[부드러운 모달 표시]

    B --> C[현재 사용량 표시]
    C --> D[더 많은 기능 안내]

    D --> E{사용자 선택}
    E -->|플랜 보기| F[요금제 페이지]
    E -->|나중에| G[모달 닫기]
    E -->|X 버튼| G

    style B fill:#f0f9ff
    style D fill:#f0fdf4
```

**UI 원칙:**
- 강제 팝업 없음 (사용자가 X로 닫을 수 있음)
- 담백한 톤 ("더 많은 기능이 필요하신가요?")
- 현재 사용량 시각화
- "나중에" 버튼 항상 제공

---

## 6. 에러 처리 플로우

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형?}

    B -->|결제 실패| C[결제 실패 안내]
    B -->|카드 문제| D[카드 변경 안내]
    B -->|네트워크| E[재시도 안내]
    B -->|서버 오류| F[고객센터 안내]

    C --> G[다른 카드 시도]
    D --> H[카드 재등록]
    E --> I[재시도 버튼]
    F --> J[이메일 문의]

    G --> K[결제 재시도]
    H --> K
    I --> K
```

---

## 7. 화면 목록 (Screen Inventory)

| 화면 ID | 화면명 | FEAT | 진입점 | 주요 액션 |
|---------|--------|------|--------|----------|
| S-01 | 메인 화면 | 기존 | 로그인 후 | 프로젝트 목록 |
| S-02 | 프로젝트 에디터 | 기존 | S-01 | 섹션 편집 |
| S-03 | 요금제 페이지 | FEAT-1 | 헤더/제한 모달 | 플랜 비교, 결제 |
| S-04 | 제한 안내 모달 | FEAT-1 | 제한 도달 시 | 업그레이드 유도 |
| S-05 | 결제 완료 | FEAT-2 | S-03 | 성공 확인 |
| S-06 | 구독 관리 | FEAT-2 | 설정 | 플랜 변경/취소 |
| S-07 | 결제 내역 | FEAT-2 | S-06 | 내역 확인 |

---

## 8. 플랜 상태 표시 UI

### 8.1 헤더 표시

```
┌─────────────────────────────────────────────────────────────┐
│  StoryFlow    [프로젝트] [템플릿]         [Free ▼]  [👤]    │
└─────────────────────────────────────────────────────────────┘
                                             ↑
                                    현재 플랜 배지
                                    클릭 시 요금제 페이지
```

### 8.2 사용량 표시 (대시보드)

```
┌─────────────────────────────────────────────────────────────┐
│  📊 사용량                                                   │
├─────────────────────────────────────────────────────────────┤
│  프로젝트    ████████░░  2/3                                 │
│  오늘 내보내기  ██████░░░░  6/10                              │
│  협업자      ██████████  1/1                                 │
│                                                             │
│  [더 많은 기능이 필요하신가요? →]                              │
└─────────────────────────────────────────────────────────────┘
```

---

## Decision Log

| # | 결정 | 이유 |
|---|------|------|
| D1 | 제한 도달 시 작업 중단 없음 | UX 유지 (저장/편집은 가능) |
| D2 | 비공격적 모달 | 공격적 업셀 회피 |
| D3 | "나중에" 버튼 필수 | 사용자 선택권 존중 |
| D4 | 현재 주기 끝까지 Pro 유지 | 취소해도 불이익 없음 |
